<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="./manifest-v2.json" />
    <meta name="theme-color" content="#ffd700" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Avalon" />
    
    <!-- App Info -->
    <title>üè∞ Avalon - Juego de Roles</title>
    <meta name="description" content="Juego de cartas de roles √©pico - Los Caballeros de la Mesa Redonda" />
    
    <!-- Icons -->
    <link rel="icon" href="./asesino.png" />
    <link rel="apple-touch-icon" href="./asesino.png" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0a0f1c;
            overflow: hidden;
        }
        
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .castle {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .title {
            color: #ffd700;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            font-family: 'Arial', sans-serif;
        }
        
        .subtitle {
            color: #cccccc;
            font-size: 16px;
            text-align: center;
            font-family: 'Arial', sans-serif;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
<meta name="theme-color" content="#1a1a2e">
</head>
<body>
    <div id="splash">
        <div class="castle">üè∞</div>
        <div class="title">AVALON</div>
        <div class="subtitle">Cargando el reino...</div>
    </div>
    
    <div id="root"></div>
    
    <script>
        // üöÄ Service Worker Enhanced con precaching estrat√©gico
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw-enhanced.js')
                    .then(registration => {
                        console.log('‚úÖ SW Enhanced registrado exitosamente', registration.scope);
                        
                        // Escuchar actualizaciones del Service Worker
                        registration.addEventListener('updatefound', () => {
                            console.log('üîÑ Nueva versi√≥n del SW encontrada');
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå SW Enhanced registration failed:', error);
                    });
                
                // Escuchar mensajes del Service Worker
                navigator.serviceWorker.addEventListener('message', event => {
                    console.log('üì® Mensaje del SW:', event.data);
                });
            });
        } else {
            console.warn('‚ö†Ô∏è Service Worker no soportado en este navegador');
        }
        
        // Ocultar splash despu√©s de cargar
        window.addEventListener('load', () => {
            console.log('üéÆ Window loaded, checking React app...');
            setTimeout(() => {
                const root = document.getElementById('root');
                const splash = document.getElementById('splash');
                
                if (root && root.innerHTML.trim()) {
                    console.log('‚úÖ React app loaded successfully');
                    if (splash) splash.style.display = 'none';
                } else {
                    console.error('‚ùå React app not loaded - root is empty');
                    console.log('Root content:', root ? root.innerHTML : 'root not found');
                }
            }, 3000); // Dar m√°s tiempo para que React se cargue
        });
        
        // Error handler global
        window.addEventListener('error', function(e) {
            console.error('‚ùå Global error:', e.message, 'at', e.filename + ':' + e.lineno);
        });
    </script>
<script src="./static/js/AppEntry-0ec3cab817b6e20a9eb17dc6ca887058.js" defer onload="console.log('‚úÖ AppEntry.js loaded successfully')" onerror="console.error('‚ùå AppEntry.js failed to load')"></script>
<script>
    // Debug adicional para React
    setTimeout(() => {
        console.log('üîç Checking for React/Expo globals...');
        console.log('window.React:', typeof window.React);
        console.log('window.ReactDOM:', typeof window.ReactDOM);
        console.log('window.expo:', typeof window.expo);
        console.log('window.__EXPO_ENV__:', window.__EXPO_ENV__);
        
        // Verificar si hay errores en el stack
        if (window.ErrorUtils) {
            console.log('‚úÖ ErrorUtils detected (React Native)');
        }
        
        // Debug del Service Worker y cache
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            console.log('üì¶ Service Worker activo detected');
            
            // Verificar cache disponible
            caches.keys().then(cacheNames => {
                console.log('üíæ Caches disponibles:', cacheNames);
                if (cacheNames.length > 0) {
                    return caches.open(cacheNames[0]);
                }
            }).then(cache => {
                if (cache) {
                    return cache.keys();
                }
            }).then(keys => {
                if (keys) {
                    console.log('üìÅ Archivos en cache:', keys.length);
                }
            }).catch(err => console.warn('‚ö†Ô∏è Error verificando cache:', err));
        }
    }, 4000);
</script>
</body>
</html>
